# Additional zsh completions (compinit already called by oh-my-zsh)
if type brew &>/dev/null; then
  FPATH="$HOMEBREW_PREFIX/share/zsh/site-functions:${FPATH}"
fi

# Prompt and navigation
export STARSHIP_LOG="error"
eval "$(starship init zsh)"
eval "$(zoxide init zsh)"

# Editor aliases
alias lvim=~/.local/bin/lvim
alias c='code'
alias c.='c .'
alias ci='code-insiders'
alias ci.='ci .'
alias cc='cursor'
alias cc.='cc .'
alias ccw='cc "$(eza --absolute ~/workspace | fzf)"'
alias ccp='cc "$(eza --absolute ~/personal | fzf)"'
alias cdw='cd "$(eza --absolute ~/workspace | fzf)"'
alias cdp='cd "$(eza --absolute ~/personal | fzf)"'

# Terminal UI tools
alias lg='lazygit'
alias ld='lazydocker'

# Browser
alias nocors='open /Applications/Google\ Chrome.app --args --user-data-dir="/var/tmp/chrome-dev-disabled-security" --disable-web-security --disable-site-isolation-trials'

# GitHub CLI
alias ghc='gh pr create --web'
alias ghd='gh pr create -d'
alias ghv='gh pr view --web'
alias ghr='gh repo view --web'
alias ghdb='gh dash'

# Git branch management with fzf
alias gb="git branch --sort=-committerdate | fzf | xargs git checkout"
alias gbr="git branch -r --sort=committerdate | sed 's/^[[:space:]]*[[:alnum:]_-]*\///' | grep -v 'HEAD ->' | fzf | xargs git checkout"
alias gbd="git branch | fzf -m | xargs git branch -D"
alias gbdm="git branch --merged origin/main | grep -v 'main' | xargs git branch -d"

# Git tag management with fzf
alias gt='git tag | fzf | xargs git checkout'
alias gtd='git tag | fzf -m | xargs git tag -d'

# Project directory shortcuts
alias w='cd ~/workspace'
alias wa='cd ~/workspace/Acquisition.Web'
alias wui='cd ~/workspace/NewDay.Web.UI'
alias wm='cd ~/workspace/Acquisition.Web.Monorepo'
alias p='cd ~/personal'

# GitHub Copilot
alias "??"='gh copilot suggest'
alias "???"='gh copilot explain'

# File listing (eza)
alias ls="eza --icons --git"
alias ll="eza -al --icons --git"
alias cat="bat --theme='ansi'"

# Utilities
alias ytd="yt-dlp"
alias zl="zellij"
alias t="tree"
alias zz="source ~/.zshrc"

# Docker shortcuts
alias dcs='docker container stop $(docker container ps -aq)'
alias dcd='docker container rm $(docker container ps -aq)'

# Python (use Homebrew version)
alias python=/opt/homebrew/bin/python3

# Package manager shortcuts
alias pn="pnpm"
alias y="yarn"
alias n="npm"

# Interactive script selector with fzf
alias s="cat package.json | jq -r '.scripts | keys[]' | sort -r | fzf"
alias ys="s | xargs yarn run"
alias ns="s | xargs npm run"
alias pns="s | xargs pnpm run"

# Terraform
alias tf="terraform"
alias tfa="terraform apply"
alias tfd="terraform destroy"
alias tfi="terraform init"
alias tfp="terraform plan"

# Functions
git_main_branch() {
  git branch -rl "*/HEAD" | rev | cut -d/ -f1 | rev
}

glc() {
  local commit1 commit2
  commit1=$(git log --color=always --oneline | fzf --ansi | cut -d ' ' -f1)
  commit2=$(git log --color=always --oneline | fzf --ansi | cut -d ' ' -f1)
  if [[ -n "$commit1" && -n "$commit2" ]]; then
    git log --pretty=format:"%s" "$commit1..$commit2"
  else
    echo "Invalid commits selected"
  fi
}

unalias gcf 2>/dev/null
gcf() {
  local commit_hash
  commit_hash=$(git log --color=always --oneline | fzf --ansi | cut -d ' ' -f1)
  git checkout "$commit_hash"
}

sync_dirs() {
  local SOURCE_DIR=$1
  local DEST_DIR=$2
  if [[ -z "$SOURCE_DIR" || -z "$DEST_DIR" ]]; then
    echo "Usage: sync_dirs source_directory target_directory"
    return 1
  fi
  if [[ ! -d "$SOURCE_DIR" ]]; then
    echo "Source directory does not exist."
    return 1
  fi
  if [[ ! -d "$DEST_DIR" ]]; then
    echo "Target directory does not exist."
    return 1
  fi
  trap 'echo "Sync process interrupted"; exit 0' SIGINT
  echo "Starting to sync from $SOURCE_DIR to $DEST_DIR"
  fswatch -o "$SOURCE_DIR" | while read f; do
    rsync -av --delete "$SOURCE_DIR" "$DEST_DIR"
  done
}

# Lazy-load NVM (only initialize when needed)
source $HOME/.nvm_setup

# Custom completions
fpath=(~/.zsh_autocomplete $fpath)

# PNPM
export PNPM_HOME="$HOME/Library/pnpm"
export PATH="$PNPM_HOME:$PATH"

# Python virtual environment (lazy activation)
source $HOME/.pyenv_setup.sh
